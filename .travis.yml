language: minimal

git:
    depth: 10

sudo: false

dist: trusty

branches:
  except:
    - /^Last_.*/

os:
    - linux

services:
    - postgresql

addons:
  apt:
    sources:
      - mysql-5.7-trusty
    packages:
      - mysql-server
      - mysql-client


before_install:
  - sudo mysql -e "use mysql; update user set authentication_string=PASSWORD('mangos') where User='root'; update user set plugin='mysql_native_password';FLUSH PRIVILEGES;"
  - sudo mysql_upgrade -u root -pmangos
  - sudo service mysql restart

script: |-
  git clone https://github.com/Lillecarl/mangos-tbc.git
  cd mangos-tbc
  export ECORE_PATH=$(pwd)
  echo "Core stored in $CORE_PATH"
  cd $TRAVIS_REPO_SLUG
  cat >  $CONFIG_FILE << EOF
  DATABASE="mangos"
  USERNAME="root"
  PASSWORD="mangos"
  CORE_PATH=$ECORE_PATH
  EOF
  cat InstallFullDB.config
